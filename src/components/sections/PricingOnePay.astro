---
import pricingOnePay from "@/content/sections/pricingOnePay";
import Section from "@/components/ui/Section.astro";

const content = pricingOnePay;
const gridCols =
    content.cols === 2
        ? "sm:grid-cols-2 lg:grid-cols-2"
        : "sm:grid-cols-2 lg:grid-cols-3";
---

<Section
    id={content.id}
    title={content.title}
    subtitle={content.subtitle}
    variant="muted"
    titleAccent="underline"
    subtitleMuted={true}
>
    <div class="container max-w-6xl">
        <!-- Value prop destacado -->
        <div class="value-container">
            <p class="value-summary">{content.valueSummary}</p>
            
            <!-- Promo con diseño profesional -->
            <div class="promo-banner" role="alert" aria-live="polite">
                <div class="promo-content">
                    <svg class="promo-icon" viewBox="0 0 24 24" aria-hidden="true">
                        <path fill="currentColor" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                    </svg>
                    <span class="promo-text">{content.promoNote}</span>
                </div>
                <div class="spot-counter">
                    <span class="spots-label">Disponibles:</span>
                    <span class="spots-number">7</span>
                </div>
            </div>
        </div>

        <!-- Grid de precios -->
        <div class="pricing-grid-wrapper">
            <ul class={`mt-12 grid ${gridCols} gap-8 items-stretch`} role="list">
                {
                    content.plans.map((p, index) => (
                        <li
                            data-popular={p.popular ? "true" : "false"}
                            data-tier={p.name.toLowerCase()}
                            class={`pricing-card h-full card ${p.popular ? "is-popular" : ''}`}
                        >
                            <!-- Badge de popular -->
                            {p.popular && (
                                <div class="popular-ribbon" aria-hidden="true">
                                    <span class="ribbon-text">Sin cuotas mensuales</span>
                                </div>
                            )}

                            <!-- Header del plan -->
                            <div class="plan-header">
                                <h3 class="plan-title">{p.name}</h3>
                                {p.description && (
                                    <p class="plan-desc">{p.description}</p>
                                )}
                                
                                <!-- Indicador visual de valor -->
                                {index === 0 && (
                                    <div class="value-indicator">
                                        <svg class="indicator-icon" viewBox="0 0 24 24" aria-hidden="true">
                                            <path fill="currentColor" d="M12 2L15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2z"/>
                                        </svg>
                                        <span class="indicator-text">Mejor relación calidad-precio</span>
                                    </div>
                                )}
                            </div>

                            <!-- Precio con CLARIDAD absoluta -->
                            <div class="price-section" aria-live="polite">
                                <div class="price-display">
                                    <div class="price-main">
                                        <div class="currency-symbol">S/</div>
                                        <div class="price-amount">{p.price}</div>
                                    </div>
                                    <div class="price-type">PAGO ÚNICO</div>
                                    <div class="price-period">Por 12 meses de servicio</div>
                                </div>
                                
                                <div class="price-details">
                                    <div class="igv-line">
                                        <svg class="check-icon" viewBox="0 0 24 24" aria-hidden="true">
                                            <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                                        </svg>
                                        <span class="igv-text">IGV incluido (18%)</span>
                                    </div>
                                    <div class="no-fees-line">
                                        <svg class="check-icon" viewBox="0 0 24 24" aria-hidden="true">
                                            <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                                        </svg>
                                        <span class="no-fees-text">Sin costos adicionales</span>
                                    </div>
                                </div>
                                
                                <!-- Ahorro anual claro -->
                                {p.popular && (
                                    <div class="savings-box">
                                        <div class="savings-header">
                                            <svg class="savings-icon" viewBox="0 0 24 24" aria-hidden="true">
                                                <path fill="currentColor" d="M11 8.75V20H8.75a.75.75 0 0 1-.75-.75V8.75a.75.75 0 0 1 .75-.75H11zM13.25 8a.75.75 0 0 1 .75.75v10.5a.75.75 0 0 1-.75.75H13V8h.25z"/>
                                            </svg>
                                            <span class="savings-title">Ahorro comprobado</span>
                                        </div>
                                        <div class="savings-details">
                                            <span class="savings-amount">~68%</span>
                                            <span class="savings-desc">vs pagos mensuales</span>
                                        </div>
                                    </div>
                                )}
                            </div>

                            <div class="divider" aria-hidden="true"></div>

                            <!-- Features con iconos diferenciados -->
                            <ul class="features-list" role="list">
                                {p.features.map((f, i) => (
                                    <li class="feature-item">
                                        <svg
                                            class="feature-icon"
                                            viewBox="0 0 24 24"
                                            aria-hidden="true"
                                        >
                                            {index === 0 ? (
                                                <!-- Express: check rápido -->
                                                <path
                                                    fill="currentColor"
                                                    d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"
                                                />
                                            ) : index === 1 ? (
                                                <!-- Full: check en círculo -->
                                                <path
                                                    fill="currentColor"
                                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                                                />
                                            ) : (
                                                <!-- Scale: diamante/premium -->
                                                <path
                                                    fill="currentColor"
                                                    d="M12 2L4.5 12 12 22l7.5-10z"
                                                />
                                            )}
                                        </svg>
                                        <span class="feature-text">{f}</span>
                                        {i === 0 && index === 0 && (
                                            <span class="included-badge">INCLUIDO</span>
                                        )}
                                    </li>
                                ))}
                            </ul>

                            <!-- Garantía destacada -->
                            <div class="guarantee-box">
                                <svg class="guarantee-icon" viewBox="0 0 24 24" aria-hidden="true">
                                    <path fill="currentColor" d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
                                </svg>
                                <div>
                                    <div class="guarantee-title">Entrega garantizada</div>
                                    <div class="guarantee-desc">5 días hábiles o revisamos el proyecto contigo</div>
                                </div>
                            </div>

                            <!-- CTA principal con texto claro -->
                            <div class="cta-container">
                                <a
                                    href={p.cta.href}
                                    class={`pricing-btn w-full ${p.popular ? 'btn-primary btn-lg' : 'btn-outline btn-md'}`}
                                    data-tier={p.name.toLowerCase()}
                                    aria-label={`Pagar S/ ${p.price} por 12 meses de servicio ${p.name}`}
                                >
                                    <span>Pagar año completo</span>
                                    <svg class="btn-arrow" viewBox="0 0 20 20" aria-hidden="true">
                                        <path fill="currentColor" d="M10 0L8.59 1.41 16.17 9H0v2h16.17l-7.58 7.59L10 20l10-10L10 0z"/>
                                    </svg>
                                </a>
                                <p class="cta-note">Todo incluido por 12 meses</p>
                            </div>
                        </li>
                    ))
                }
            </ul>
        </div>

        <!-- Notas al pie mejoradas -->
        {
            content.footnotes.length > 0 && (
                <div class="footnotes-container">
                    <div class="footnotes-header">
                        <svg class="footnotes-icon" viewBox="0 0 24 24" aria-hidden="true">
                            <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                        </svg>
                        <h4 class="footnotes-title">Transparencia total</h4>
                    </div>
                    <ul class="footnotes-list" role="list">
                        {content.footnotes.map((f) => (
                            <li class="footnote-item">
                                <svg class="footnote-bullet" viewBox="0 0 8 8" aria-hidden="true">
                                    <circle cx="4" cy="4" r="3" fill="currentColor"/>
                                </svg>
                                <span>{f}</span>
                            </li>
                        ))}
                    </ul>
                </div>
            )
        }
    </div>
</Section>

<style>
    /* Contenedor de valor */
    .value-container {
        text-align: center;
        max-width: 48rem;
        margin: 0 auto;
    }

    .value-summary {
        font-size: var(--text-lg);
        line-height: 1.6;
        color: var(--color-fg);
        margin-bottom: var(--space-6);
        font-weight: 500;
    }

    /* Banner de promoción profesional */
    .promo-banner {
        background: linear-gradient(135deg, 
            color-mix(in oklch, var(--color-primary) 10%, var(--color-bg)),
            color-mix(in oklch, var(--color-primary) 5%, var(--color-bg))
        );
        border: 1px solid color-mix(in oklch, var(--color-primary) 30%, transparent);
        border-radius: var(--radius-xl);
        padding: var(--space-4) var(--space-6);
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-8);
    }

    .promo-content {
        display: flex;
        align-items: center;
        gap: var(--space-3);
    }

    .promo-icon {
        width: 20px;
        height: 20px;
        color: var(--color-primary);
        flex-shrink: 0;
    }

    .promo-text {
        font-weight: 600;
        color: var(--color-fg);
        font-size: var(--text-base);
    }

    .spot-counter {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        background: var(--color-bg-elev);
        padding: var(--space-2) var(--space-3);
        border-radius: var(--radius-full);
        border: 1px solid var(--color-border);
        white-space: nowrap;
    }

    .spots-label {
        font-size: var(--text-xs);
        color: var(--color-fg-muted);
    }

    .spots-number {
        font-weight: 800;
        color: var(--color-primary);
        font-size: var(--text-sm);
    }

    /* Contenedor de grid */
    .pricing-grid-wrapper {
        position: relative;
    }

    /* Tarjetas de pricing mejoradas */
    .pricing-card {
        position: relative;
        overflow: hidden;
        isolation: isolate;
        border: 1px solid var(--color-border);
        border-radius: var(--radius-2xl);
        background: var(--color-surface);
        box-shadow: var(--shadow-sm);
        padding: var(--space-6);
        transition: all 0.25s ease;
        display: flex;
        flex-direction: column;
    }

    .pricing-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
        border-color: color-mix(in oklch, var(--color-primary) 30%, var(--color-border));
    }

    @media (min-width: 1024px) {
        .pricing-card {
            padding: var(--space-8);
        }
    }

    /* Ribbon profesional - FIXED */
    .popular-ribbon {
        position: absolute;
        top: 18px;
        right: -42px;
        background: var(--color-primary);
        color: var(--color-on-primary);
        padding: 6px 48px;
        font-size: 11px;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        transform: rotate(45deg);
        box-shadow: var(--shadow-sm);
        z-index: 10;
        width: 180px;
        text-align: center;
    }

    .ribbon-text {
        display: block;
        line-height: 1.2;
    }

    /* Header del plan */
    .plan-header {
        margin-bottom: var(--space-6);
        padding-top: 12px; /* Espacio para ribbon */
    }

    .plan-title {
        font-weight: 900;
        letter-spacing: -0.02em;
        font-size: var(--text-2xl);
        color: var(--color-fg);
        margin-bottom: var(--space-2);
    }

    .plan-desc {
        font-size: var(--text-sm);
        color: var(--color-fg-muted);
        line-height: 1.5;
    }

    .value-indicator {
        display: inline-flex;
        align-items: center;
        gap: var(--space-2);
        background: color-mix(in oklch, var(--color-primary) 12%, transparent);
        color: var(--color-primary);
        padding: var(--space-1) var(--space-3);
        border-radius: var(--radius-full);
        margin-top: var(--space-3);
        font-size: var(--text-xs);
        font-weight: 600;
    }

    .indicator-icon {
        width: 14px;
        height: 14px;
    }

    /* Sección de precio - CLARIFICADA */
    .price-section {
        margin-bottom: var(--space-6);
    }

    .price-display {
        display: flex;
        flex-direction: column;
        gap: var(--space-2);
        margin-bottom: var(--space-4);
    }

    .price-main {
        display: flex;
        align-items: baseline;
        gap: var(--space-2);
    }

    .currency-symbol {
        font-size: var(--text-xl);
        font-weight: 600;
        color: var(--color-fg-muted);
    }

    .price-amount {
        font-weight: 900;
        font-size: clamp(3rem, 4vw, 4rem);
        line-height: 1;
        letter-spacing: -0.03em;
        color: var(--color-fg);
    }

    .price-type {
        background: var(--color-primary);
        color: var(--color-on-primary);
        padding: var(--space-1) var(--space-3);
        border-radius: var(--radius-md);
        font-size: var(--text-sm);
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        display: inline-block;
        width: fit-content;
    }

    .price-period {
        font-size: var(--text-sm);
        font-weight: 600;
        color: var(--color-fg-muted);
        line-height: 1.4;
    }

    /* Detalles de precio sin saltos de línea */
    .price-details {
        display: grid;
        gap: var(--space-2);
        margin-bottom: var(--space-4);
    }

    .igv-line, .no-fees-line {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        font-size: var(--text-sm);
    }

    .check-icon {
        width: 16px;
        height: 16px;
        color: var(--color-success);
        flex-shrink: 0;
    }

    .igv-text {
        color: var(--color-success);
        font-weight: 600;
    }

    .no-fees-text {
        color: var(--color-fg-muted);
        font-weight: 500;
    }

    /* Ahorro bien presentado */
    .savings-box {
        background: color-mix(in oklch, var(--color-success) 8%, transparent);
        border: 1px solid color-mix(in oklch, var(--color-success) 20%, transparent);
        border-radius: var(--radius-lg);
        padding: var(--space-3);
    }

    .savings-header {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        margin-bottom: var(--space-1);
    }

    .savings-icon {
        width: 16px;
        height: 16px;
        color: var(--color-success);
    }

    .savings-title {
        font-size: var(--text-xs);
        font-weight: 700;
        color: var(--color-success);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .savings-details {
        display: flex;
        align-items: baseline;
        gap: var(--space-2);
    }

    .savings-amount {
        font-size: var(--text-xl);
        font-weight: 900;
        color: var(--color-success);
    }

    .savings-desc {
        font-size: var(--text-sm);
        color: var(--color-fg-muted);
        font-weight: 500;
    }

    /* Divider */
    .divider {
        height: 1px;
        background: linear-gradient(90deg, 
            transparent 0%,
            var(--color-border) 20%,
            var(--color-border) 80%,
            transparent 100%
        );
        margin: var(--space-6) 0;
        opacity: 0.5;
    }

    /* Lista de features */
    .features-list {
        flex: 1;
        display: grid;
        gap: var(--space-3);
        margin-bottom: var(--space-6);
    }

    .feature-item {
        display: grid;
        grid-template-columns: 20px 1fr auto;
        gap: var(--space-3);
        align-items: start;
        font-size: var(--text-sm);
        line-height: 1.5;
    }

    .feature-icon {
        width: 20px;
        height: 20px;
        margin-top: 2px;
        flex-shrink: 0;
        color: var(--color-primary);
    }

    .feature-text {
        color: var(--color-fg);
    }

    .included-badge {
        background: color-mix(in oklch, var(--color-success) 15%, transparent);
        color: var(--color-success);
        padding: var(--space-1) var(--space-2);
        border-radius: var(--radius-md);
        font-size: var(--text-xs);
        font-weight: 700;
        white-space: nowrap;
    }

    /* Garantía */
    .guarantee-box {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        background: color-mix(in oklch, var(--color-primary) 5%, transparent);
        border: 1px solid color-mix(in oklch, var(--color-primary) 20%, transparent);
        border-radius: var(--radius-lg);
        padding: var(--space-3) var(--space-4);
        margin-bottom: var(--space-6);
    }

    .guarantee-icon {
        width: 20px;
        height: 20px;
        color: var(--color-primary);
        flex-shrink: 0;
    }

    .guarantee-title {
        font-weight: 700;
        font-size: var(--text-sm);
        color: var(--color-fg);
    }

    .guarantee-desc {
        font-size: var(--text-xs);
        color: var(--color-fg-muted);
        line-height: 1.4;
    }

    /* CTA mejorado */
    .cta-container {
        margin-top: auto;
    }

    .pricing-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-2);
        padding: var(--space-4) var(--space-6);
        font-weight: 700;
        border-radius: var(--radius-xl);
        transition: all 0.2s ease;
        border: 2px solid transparent;
        text-decoration: none;
        margin-bottom: var(--space-2);
    }

    .pricing-btn:hover {
        transform: translateY(-2px);
    }

    .btn-primary {
        background: var(--color-primary);
        color: var(--color-on-primary);
    }

    .btn-primary:hover {
        background: color-mix(in oklch, var(--color-primary) 90%, black);
        box-shadow: var(--shadow-lg);
    }

    .btn-outline {
        background: transparent;
        color: var(--color-primary);
        border-color: var(--color-primary);
    }

    .btn-outline:hover {
        background: color-mix(in oklch, var(--color-primary) 10%, transparent);
        box-shadow: var(--shadow-md);
    }

    .btn-arrow {
        width: 16px;
        height: 16px;
        transition: transform 0.2s ease;
    }

    .pricing-btn:hover .btn-arrow {
        transform: translateX(4px);
    }

    .cta-note {
        font-size: var(--text-xs);
        color: var(--color-fg-muted);
        text-align: center;
        font-weight: 500;
    }

    /* Footnotes mejorados */
    .footnotes-container {
        margin-top: var(--space-12);
        padding: var(--space-6);
        background: var(--color-bg-elev);
        border-radius: var(--radius-xl);
        border: 1px solid var(--color-border);
    }

    .footnotes-header {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        margin-bottom: var(--space-4);
    }

    .footnotes-icon {
        width: 20px;
        height: 20px;
        color: var(--color-fg-muted);
    }

    .footnotes-title {
        font-size: var(--text-base);
        font-weight: 700;
        color: var(--color-fg);
        margin: 0;
    }

    .footnotes-list {
        display: grid;
        gap: var(--space-3);
    }

    .footnote-item {
        display: grid;
        grid-template-columns: 12px 1fr;
        gap: var(--space-3);
        align-items: start;
        font-size: var(--text-sm);
        line-height: 1.5;
        color: var(--color-fg-muted);
    }

    .footnote-bullet {
        width: 12px;
        height: 12px;
        margin-top: 5px;
        color: var(--color-primary);
    }

    /* Responsive */
    @media (max-width: 768px) {
        .pricing-card {
            padding: var(--space-5);
        }

        .promo-banner {
            flex-direction: column;
            gap: var(--space-3);
            text-align: center;
            padding: var(--space-4);
        }

        .popular-ribbon {
            right: -38px;
            padding: 5px 40px;
            font-size: 10px;
            top: 16px;
        }

        .price-main {
            flex-wrap: wrap;
        }

        .features-list {
            gap: var(--space-4);
        }

        .feature-item {
            grid-template-columns: 20px 1fr;
        }

        .included-badge {
            grid-column: 2;
            justify-self: start;
            margin-top: var(--space-1);
        }
    }

    @media (max-width: 640px) {
        .grid {
            grid-template-columns: 1fr !important;
        }

        .price-amount {
            font-size: 3.5rem;
        }
    }
</style>