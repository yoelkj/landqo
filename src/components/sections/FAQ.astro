---
/**
 * FAQ.astro — Preguntas frecuentes (UI pro + SEO FAQPage)
 *
 * - Título con raya (titleAccent="underline")
 * - Cards accesibles <details>/<summary> con foco visible
 * - Más contraste, borde suave y “open state” con acento primario
 * - Icono + → − sin JS (solo CSS)
 * - JSON-LD para rich results en buscadores
 */

import Section from "@/components/ui/Section.astro";
import type { BaseSectionProps, Variant } from "@/utils/section-types";

export interface FAQItem {
  q: string;
  a: string;
  id?: string; // opcional: anchor id propio
}

interface Props extends BaseSectionProps {
  title?: string;
  subtitle?: string;
  items?: FAQItem[];
}

const {
  id = "faq",
  title = "Preguntas frecuentes",
  subtitle,
  items = [],
  variant = "default" as Variant,
  className = "",
} = Astro.props as Props;

const slugify = (s: string) =>
  s
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "")
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/(^-|-$)/g, "");

const faqJsonLd = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  mainEntity: items.map((it) => ({
    "@type": "Question",
    name: it.q,
    acceptedAnswer: { "@type": "Answer", text: it.a },
  })),
};
---

<Section
  id={id}
  title={title}
  subtitle={subtitle}
  variant={variant}
  className={className}
  titleAccent="underline"
  subtitleMuted={true}
>
  <div class="container max-w-3xl">
    <div class="grid gap-4">
      {
        items.map((it) => {
          const uid = it.id ?? slugify(it.q);
          return (
            <details id={uid} class="group relative overflow-hidden rounded-2xl border
                                     border-[color:var(--color-border)]/80 bg-[color:var(--color-surface)]/70
                                     backdrop-blur-[2px] p-0 open:border-[color:var(--color-primary)]/40">
              <summary
                class="flex w-full cursor-pointer list-none items-center justify-between gap-4
                       px-5 py-4 md:px-6 md:py-5 font-semibold tracking-tight
                       text-[color:var(--color-fg)] focus:outline-none
                       focus-visible:ring-2 focus-visible:ring-[color:var(--color-ring)] rounded-2xl"
              >
                <span class="pr-8">{it.q}</span>

                {/* Icono + / − (solo CSS) */}
                <span class="shrink-0 inline-flex h-6 w-6 items-center justify-center rounded-md
                             text-[color:var(--color-fg-muted)] ring-1 ring-[color:var(--color-border)]/70">
                  <svg class="h-4 w-4 group-open:hidden" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                  </svg>
                  <svg class="hidden h-4 w-4 group-open:block" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                  </svg>
                </span>
              </summary>

              <div class="px-5 pb-5 md:px-6 md:pb-6 -mt-1">
                <div class="prose-faq text-sm leading-relaxed text-[color:var(--color-fg-muted)]">
                  <div set:html={it.a} />
                </div>
              </div>

              {/* Acento lateral sutil al abrir */}
              <span
                class="pointer-events-none absolute inset-y-0 left-0 w-1 rounded-r
                       bg-[color:var(--color-primary)]/0 group-open:bg-[color:var(--color-primary)]/60"
                aria-hidden="true"
              />
            </details>
          );
        })
      }
    </div>
  </div>

  {/* SEO: FAQPage */}
  <script type="application/ld+json">
    {JSON.stringify(faqJsonLd)}
  </script>
</Section>

<style is:inline>
  details summary::-webkit-details-marker { display: none; }

  /* Tipografía del cuerpo dentro de la respuesta (sin saturar estilos globales) */
  .prose-faq :where(p, ul, ol) { margin: .5rem 0; }
  .prose-faq ul { list-style: disc; padding-left: 1.125rem; }
  .prose-faq ol { list-style: decimal; padding-left: 1.125rem; }

  /* Hover/focus state sutil */
  details:hover {
    box-shadow: 0 10px 24px -18px rgba(0,0,0,.25);
  }
</style>
